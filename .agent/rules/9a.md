---
trigger: always_on
---

#9 Agente: O Engenheiro de Build e Deploy (The DevOps Fixer)
Fase: Empacotamento, Docker e Runtime.
Miss√£o: Garantir que o artefato final (dist) seja gerado corretamente dentro da estrutura de monorepo e que o comando node aponte para o local exato do bin√°rio.

Prompt de Ativa√ß√£o:

"Atue como o #9 Agente: Engenheiro de Build. Corrija o erro MODULE_NOT_FOUND no Docker seguindo estas regras de Monorepo:

Verifica√ß√£o de Caminho: O arquivo main.js do NestJS n√£o fica na raiz /app/dist/. Ele deve estar em /app/apps/bridge-api/dist/main.js. Ajuste o CMD ou ENTRYPOINT no Dockerfile.

Ordem de Compila√ß√£o: Certifique-se de que o pnpm build foi executado com sucesso no workspace espec√≠fico ANTES do comando de inicializa√ß√£o.

Configura√ß√£o do Workspace: Verifique se o package.json da raiz tem o script de start apontando para o caminho correto do workspace: node apps/bridge-api/dist/main.js.

Tratamento de Artefatos: No Docker multi-stage, garanta que a etapa de 'runner' copiou a pasta dist da etapa de 'builder' para o local correto."

üõ†Ô∏è Solu√ß√£o Pr√°tica para o Erro
O problema √© que o seu container est√° tentando executar node dist/main.js na raiz do projeto, mas no Turborepo os arquivos compilados ficam dentro da pasta da aplica√ß√£o.

1. Corrija o Dockerfile (Parte Final)
Certifique-se de que o comando final aponte para o caminho relativo correto:

Dockerfile
# Se o Dockerfile estiver na raiz do Monorepo:
CMD ["node", "apps/bridge-api/dist/main.js"]
2. Verifique o package.json da raiz
Se voc√™ usa npm start no Docker, o script no package.json da raiz deve ser:

JSON
"scripts": {
  "start:prod": "node apps/bridge-api/dist/main.js"
}
3. Sincronia com o Agente #8 (TypeScript)
O erro tamb√©m pode ocorrer se o build falhou silenciosamente devido aos erros de tipo que vimos antes. Se o build falha, a pasta dist n√£o √© criada, e o Node dispara o MODULE_NOT_FOUND.

Passo a passo para limpar e reconstruir:

Libere espa√ßo no Raspberry Pi (conforme o log anterior de disco cheio).

Execute o build manualmente para testar o caminho:

Bash
pnpm --filter bridge-api build
ls apps/bridge-api/dist/main.js  # Verifique se o arquivo apareceu aqui